<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pyrocko.snuffling &#8212; Pyrocko v0.3 Manual</title>
    
    <link rel="stylesheet" href="../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Pyrocko v0.3 Manual"
          href="../../_static/opensearch.xml"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="shortcut icon" type="image/png" href="../../_static/favicon.png" />
    <meta name="viewport" content="width=device-width,initial-scale=0.8">
    
    
    

  </head>
  <body role="document">
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="responsive-menu"><a href="#sidebar-anchor" title="Navigation">&#9776;</a></li>
        <li><a href="../../index.html">Pyrocko v0.3 Manual</a> &#187;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
    
  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for pyrocko.snuffling</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Snuffling infrastructure</span>

<span class="sd">This module provides the base class :py:class:`Snuffling` for user-defined</span>
<span class="sd">snufflings and some utilities for their handling.</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">tempfile</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="k">import</span> <span class="n">QtCore</span> <span class="k">as</span> <span class="n">qc</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="k">import</span> <span class="n">QtGui</span> <span class="k">as</span> <span class="n">qg</span>

<span class="kn">from</span> <span class="nn">pyrocko</span> <span class="k">import</span> <span class="n">pile</span><span class="p">,</span> <span class="n">config</span>

<span class="kn">from</span> <span class="nn">pyrocko.gui_util</span> <span class="k">import</span> <span class="n">ValControl</span><span class="p">,</span> <span class="n">LinValControl</span><span class="p">,</span> <span class="n">FigureFrame</span><span class="p">,</span> \
    <span class="n">WebKitFrame</span><span class="p">,</span> <span class="n">VTKFrame</span><span class="p">,</span> <span class="n">PixmapFrame</span><span class="p">,</span> <span class="n">Marker</span><span class="p">,</span> <span class="n">EventMarker</span><span class="p">,</span> <span class="n">PhaseMarker</span><span class="p">,</span> \
    <span class="n">load_markers</span><span class="p">,</span> <span class="n">save_markers</span>


<span class="n">Marker</span><span class="p">,</span> <span class="n">load_markers</span><span class="p">,</span> <span class="n">save_markers</span>  <span class="c"># noqa</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;pyrocko.snuffling&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_str_traceback</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;%s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">]))</span>


<span class="k">class</span> <span class="nc">MyFrame</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">QFrame</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">showEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;widgetVisibilityChanged(bool)&#39;</span><span class="p">),</span> <span class="k">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">hideEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;widgetVisibilityChanged(bool)&#39;</span><span class="p">),</span> <span class="k">False</span><span class="p">)</span>


<div class="viewcode-block" id="Param"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Param">[docs]</a><span class="k">class</span> <span class="nc">Param</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Definition of an adjustable floating point parameter for the</span>
<span class="sd">    snuffling. The snuffling may display controls for user input for</span>
<span class="sd">    such parameters.</span>

<span class="sd">    :param name: labels the parameter on the snuffling&#39;s control panel</span>
<span class="sd">    :param ident: identifier of the parameter</span>
<span class="sd">    :param default: default value</span>
<span class="sd">    :param minimum: minimum value for the parameter</span>
<span class="sd">    :param maximum: maximum value for the parameter</span>
<span class="sd">    :param low_is_none: if ``True``: parameter is set to None at lowest value</span>
<span class="sd">        of parameter range (optional)</span>
<span class="sd">    :param high_is_none: if ``True``: parameter is set to None at highest value</span>
<span class="sd">        of parameter range (optional)</span>
<span class="sd">    :param low_is_zero: if ``True``: parameter is set to value 0 at lowest</span>
<span class="sd">        value of parameter range (optional)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">maximum</span><span class="p">,</span>
            <span class="n">low_is_none</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
            <span class="n">high_is_none</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
            <span class="n">low_is_zero</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">low_is_none</span> <span class="ow">and</span> <span class="n">default</span> <span class="o">==</span> <span class="n">minimum</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="k">None</span>
        <span class="k">if</span> <span class="n">high_is_none</span> <span class="ow">and</span> <span class="n">default</span> <span class="o">==</span> <span class="n">maximum</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="k">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ident</span> <span class="o">=</span> <span class="n">ident</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">minimum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">maximum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low_is_none</span> <span class="o">=</span> <span class="n">low_is_none</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">high_is_none</span> <span class="o">=</span> <span class="n">high_is_none</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low_is_zero</span> <span class="o">=</span> <span class="n">low_is_zero</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_control</span> <span class="o">=</span> <span class="k">None</span></div>


<div class="viewcode-block" id="Switch"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Switch">[docs]</a><span class="k">class</span> <span class="nc">Switch</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Definition of a boolean switch for the snuffling. The snuffling</span>
<span class="sd">    may display a checkbox for such a switch.</span>

<span class="sd">    :param name:    labels the switch on the snuffling&#39;s control panel</span>
<span class="sd">    :param ident:   identifier of the parameter</span>
<span class="sd">    :param default: default value</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ident</span> <span class="o">=</span> <span class="n">ident</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span></div>


<div class="viewcode-block" id="Choice"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Choice">[docs]</a><span class="k">class</span> <span class="nc">Choice</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Definition of a string choice for the snuffling. The snuffling</span>
<span class="sd">    may display a menu for such a choice.</span>

<span class="sd">    :param name:    labels the menu on the snuffling&#39;s control panel</span>
<span class="sd">    :param ident:   identifier of the parameter</span>
<span class="sd">    :param default: default value</span>
<span class="sd">    :param choices: tuple of other options</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">choices</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ident</span> <span class="o">=</span> <span class="n">ident</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span></div>


<div class="viewcode-block" id="Snuffling"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling">[docs]</a><span class="k">class</span> <span class="nc">Snuffling</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;Base class for user snufflings.</span>

<span class="sd">    Snufflings are plugins for snuffler (and other applications using the</span>
<span class="sd">    :py:class:`pyrocko.pile_viewer.PileOverview` class defined in</span>
<span class="sd">    ``pile_viewer.py``). They can be added, removed and reloaded at runtime and</span>
<span class="sd">    should provide a simple way of extending the functionality of snuffler.</span>

<span class="sd">    A snuffling has access to all data available in a pile viewer, can process</span>
<span class="sd">    this data and can create and add new traces and markers to the viewer.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="k">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s">&#39;Untitled Snuffling&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tickets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_markers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_panel</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_menuitem</span> <span class="o">=</span> <span class="k">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_panel_parent</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_parent</span> <span class="o">=</span> <span class="k">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_panel</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menuitem</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_helpmenuitem</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param_controls</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_triggers</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_live_update</span> <span class="o">=</span> <span class="k">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_output_filename</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_input_filename</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_input_directory</span> <span class="o">=</span> <span class="k">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tempdir</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_iplot</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_have_pre_process_hook</span> <span class="o">=</span> <span class="k">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_have_post_process_hook</span> <span class="o">=</span> <span class="k">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_process_hook_enabled</span> <span class="o">=</span> <span class="k">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_process_hook_enabled</span> <span class="o">=</span> <span class="k">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_no_viewer_pile</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cli_params</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_force_panel</span> <span class="o">=</span> <span class="k">False</span>

<div class="viewcode-block" id="Snuffling.setup"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.setup">[docs]</a>    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Setup the snuffling.</span>

<span class="sd">        This method should be implemented in subclass and contain e.g. calls to</span>
<span class="sd">        :py:meth:`set_name` and :py:meth:`add_parameter`.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="Snuffling.module_dir"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.module_dir">[docs]</a>    <span class="k">def</span> <span class="nf">module_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the path of the directory where snufflings are stored.</span>

<span class="sd">        The default path is ``$HOME/.snufflings``.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span></div>

<div class="viewcode-block" id="Snuffling.init_gui"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.init_gui">[docs]</a>    <span class="k">def</span> <span class="nf">init_gui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">viewer</span><span class="p">,</span> <span class="n">panel_parent</span><span class="p">,</span> <span class="n">menu_parent</span><span class="p">,</span> <span class="n">reloaded</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set parent viewer and hooks to add panel and menu entry.</span>

<span class="sd">        This method is called from the</span>
<span class="sd">        :py:class:`pyrocko.pile_viewer.PileOverview` object. Calls</span>
<span class="sd">        :py:meth:`setup_gui`.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span> <span class="o">=</span> <span class="n">viewer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_panel_parent</span> <span class="o">=</span> <span class="n">panel_parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_parent</span> <span class="o">=</span> <span class="n">menu_parent</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_gui</span><span class="p">(</span><span class="n">reloaded</span><span class="o">=</span><span class="n">reloaded</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.setup_gui"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.setup_gui">[docs]</a>    <span class="k">def</span> <span class="nf">setup_gui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reloaded</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create and add gui elements to the viewer.</span>

<span class="sd">        This method is initially called from :py:meth:`init_gui`. It is also</span>
<span class="sd">        called, e.g. when new parameters have been added or if the name of the</span>
<span class="sd">        snuffling has been changed.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_panel_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_panel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_panel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_panel_parent</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_panel</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_panel_parent</span><span class="o">.</span><span class="n">add_panel</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_panel</span><span class="p">,</span> <span class="n">reloaded</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menu_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_menuitem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_menuitem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_menu_parent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_helpmenuitem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_helpmenuitem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_menu_parent</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menuitem</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_menu_parent</span><span class="o">.</span><span class="n">add_snuffling_menuitem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_menuitem</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_helpmenuitem</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_menu_parent</span><span class="o">.</span><span class="n">add_snuffling_help_menuitem</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_helpmenuitem</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.set_force_panel"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.set_force_panel">[docs]</a>    <span class="k">def</span> <span class="nf">set_force_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bool</span><span class="o">=</span><span class="k">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Force to create a panel.</span>

<span class="sd">        :param bool: if ``True`` will create a panel with Help, Clear and Run</span>
<span class="sd">            button.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_force_panel</span> <span class="o">=</span> <span class="nb">bool</span></div>

    <span class="k">def</span> <span class="nf">make_cli_parser1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">optparse</span>

        <span class="k">class</span> <span class="nc">MyOptionParser</span><span class="p">(</span><span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">parser</span> <span class="o">=</span> <span class="n">MyOptionParser</span><span class="p">()</span>

        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s">&#39;--format&#39;</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s">&#39;format&#39;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="s">&#39;from_extension&#39;</span><span class="p">,</span>
            <span class="n">choices</span><span class="o">=</span><span class="p">(</span>
                <span class="s">&#39;mseed&#39;</span><span class="p">,</span> <span class="s">&#39;sac&#39;</span><span class="p">,</span> <span class="s">&#39;kan&#39;</span><span class="p">,</span> <span class="s">&#39;segy&#39;</span><span class="p">,</span> <span class="s">&#39;seisan&#39;</span><span class="p">,</span> <span class="s">&#39;seisan.l&#39;</span><span class="p">,</span>
                <span class="s">&#39;seisan.b&#39;</span><span class="p">,</span> <span class="s">&#39;gse1&#39;</span><span class="p">,</span> <span class="s">&#39;gcf&#39;</span><span class="p">,</span> <span class="s">&#39;yaff&#39;</span><span class="p">,</span> <span class="s">&#39;datacube&#39;</span><span class="p">,</span>
                <span class="s">&#39;from_extension&#39;</span><span class="p">,</span> <span class="s">&#39;detect&#39;</span><span class="p">),</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;assume files are of given FORMAT [default: </span><span class="se">\&#39;</span><span class="s">%default</span><span class="se">\&#39;</span><span class="s">]&#39;</span><span class="p">)</span>

        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
            <span class="s">&#39;--pattern&#39;</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s">&#39;regex&#39;</span><span class="p">,</span>
            <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;REGEX&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;only include files whose paths match REGEX&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_params_to_cli_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">configure_cli_parser</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parser</span>

    <span class="k">def</span> <span class="nf">configure_cli_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">cli_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">None</span>

    <span class="k">def</span> <span class="nf">add_params_to_cli_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Param</span><span class="p">):</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span>
                    <span class="s">&#39;--&#39;</span> <span class="o">+</span> <span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="s">&#39;float&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_cli</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_cli_parser1</span><span class="p">()</span>
        <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Param</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cli_params</span><span class="p">[</span><span class="s">&#39;regex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">regex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cli_params</span><span class="p">[</span><span class="s">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cli_params</span><span class="p">[</span><span class="s">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span>

        <span class="k">return</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">parser</span>

<div class="viewcode-block" id="Snuffling.delete_gui"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.delete_gui">[docs]</a>    <span class="k">def</span> <span class="nf">delete_gui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove the gui elements of the snuffling.</span>

<span class="sd">        This removes the panel and menu entry of the widget from the viewer and</span>
<span class="sd">        also removes all traces and markers added with the</span>
<span class="sd">        :py:meth:`add_traces` and :py:meth:`add_markers` methods.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_panel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_panel_parent</span><span class="o">.</span><span class="n">remove_panel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_panel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_panel</span> <span class="o">=</span> <span class="k">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menuitem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_menu_parent</span><span class="o">.</span><span class="n">remove_snuffling_menuitem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_menuitem</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_menuitem</span> <span class="o">=</span> <span class="k">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_helpmenuitem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_menu_parent</span><span class="o">.</span><span class="n">remove_snuffling_help_menuitem</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_helpmenuitem</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.set_name"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set the snuffling&#39;s name.</span>

<span class="sd">        The snuffling&#39;s name is shown as a menu entry and in the panel header.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_gui</span><span class="p">()</span></div>

<div class="viewcode-block" id="Snuffling.get_name"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the snuffling&#39;s name.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span></div>

    <span class="k">def</span> <span class="nf">set_have_pre_process_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_have_pre_process_hook</span> <span class="o">=</span> <span class="nb">bool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_update</span> <span class="o">=</span> <span class="k">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_process_hook_enabled</span> <span class="o">=</span> <span class="k">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_gui</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_have_post_process_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_have_post_process_hook</span> <span class="o">=</span> <span class="nb">bool</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_live_update</span> <span class="o">=</span> <span class="k">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_post_process_hook_enabled</span> <span class="o">=</span> <span class="k">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_gui</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_have_pile_changed_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pile_</span> <span class="o">=</span> <span class="k">False</span>

<div class="viewcode-block" id="Snuffling.enable_pile_changed_notifications"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.enable_pile_changed_notifications">[docs]</a>    <span class="k">def</span> <span class="nf">enable_pile_changed_notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get informed when pile changed.</span>

<span class="sd">        When activated, the :py:meth:`pile_changed` method is called on every</span>
<span class="sd">        update in the viewer&#39;s pile.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">viewer</span><span class="p">,</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;pile_has_changed_signal()&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pile_changed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.disable_pile_changed_notifications"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.disable_pile_changed_notifications">[docs]</a>    <span class="k">def</span> <span class="nf">disable_pile_changed_notifications</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Stop getting informed about changes in viewer&#39;s pile.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span>
        <span class="n">viewer</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span>
            <span class="n">viewer</span><span class="p">,</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;pile_has_changed_signal()&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pile_changed</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.pile_changed"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.pile_changed">[docs]</a>    <span class="k">def</span> <span class="nf">pile_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Called when the connected viewer&#39;s pile has changed.</span>

<span class="sd">        Must be activated with a call to</span>
<span class="sd">        :py:meth:`enable_pile_changed_notifications`.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="Snuffling.reset_gui"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.reset_gui">[docs]</a>    <span class="k">def</span> <span class="nf">reset_gui</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reloaded</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Delete and recreate the snuffling&#39;s panel.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_panel</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menuitem</span><span class="p">:</span>
            <span class="n">sett</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_settings</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_gui</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_gui</span><span class="p">(</span><span class="n">reloaded</span><span class="o">=</span><span class="n">reloaded</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_settings</span><span class="p">(</span><span class="n">sett</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.show_message"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.show_message">[docs]</a>    <span class="k">def</span> <span class="nf">show_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Display a message box.</span>

<span class="sd">        :param kind: string defining kind of message</span>
<span class="sd">        :param message: the message to be displayed</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">())</span>
            <span class="n">box</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;%s: %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">kind</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span> <span class="n">message</span><span class="p">))</span>
            <span class="n">box</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">NoViewerSet</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="Snuffling.error"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Show an error message box.</span>

<span class="sd">        :param message: specifying the error</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;%s: %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_message</span><span class="p">(</span><span class="s">&#39;error&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.warn"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.warn">[docs]</a>    <span class="k">def</span> <span class="nf">warn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Display a warning message.</span>

<span class="sd">        :param message: specifying the warning</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;%s: %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">message</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_message</span><span class="p">(</span><span class="s">&#39;warning&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.fail"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.fail">[docs]</a>    <span class="k">def</span> <span class="nf">fail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Show an error message box and raise :py:exc:`SnufflingCallFailed`</span>
<span class="sd">        exception.</span>

<span class="sd">        :param message: specifying the error</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">SnufflingCallFailed</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.pylab"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.pylab">[docs]</a>    <span class="k">def</span> <span class="nf">pylab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">get</span><span class="o">=</span><span class="s">&#39;axes&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a :py:class:`FigureFrame` and return either the frame,</span>
<span class="sd">        a :py:class:`matplotlib.figure.Figure` instance or a</span>
<span class="sd">        :py:class:`matplotlib.axes.Axes` instance.</span>

<span class="sd">        :param name: labels the figure frame&#39;s tab</span>
<span class="sd">        :param get: &#39;axes&#39;|&#39;figure&#39;|&#39;frame&#39; (optional)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iplot</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Plot %i (%s)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iplot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>

        <span class="n">fframe</span> <span class="o">=</span> <span class="n">FigureFrame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_panel_parent</span><span class="o">.</span><span class="n">add_tab</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fframe</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">get</span> <span class="o">==</span> <span class="s">&#39;axes&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fframe</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">get</span> <span class="o">==</span> <span class="s">&#39;figure&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fframe</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">get</span> <span class="o">==</span> <span class="s">&#39;figure_frame&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fframe</span></div>

<div class="viewcode-block" id="Snuffling.figure"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.figure">[docs]</a>    <span class="k">def</span> <span class="nf">figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a :py:class:`matplotlib.figure.Figure` instance</span>
<span class="sd">        which can be displayed within snuffler by calling</span>
<span class="sd">        :py:meth:`canvas.draw`.</span>

<span class="sd">        :param name: labels the tab of the figure</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pylab</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">get</span><span class="o">=</span><span class="s">&#39;figure&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.axes"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.axes">[docs]</a>    <span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a :py:class:`matplotlib.axes.Axes` instance.</span>

<span class="sd">        :param name: labels the tab of axes</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pylab</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">get</span><span class="o">=</span><span class="s">&#39;axes&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.figure_frame"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.figure_frame">[docs]</a>    <span class="k">def</span> <span class="nf">figure_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a :py:class:`pyrocko.gui_util.FigureFrame`.</span>

<span class="sd">        :param name: labels the tab figure frame</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pylab</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">get</span><span class="o">=</span><span class="s">&#39;figure_frame&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.pixmap_frame"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.pixmap_frame">[docs]</a>    <span class="k">def</span> <span class="nf">pixmap_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a :py:class:`pyrocko.gui_util.PixmapFrame`</span>

<span class="sd">        :param name: labels the tab</span>
<span class="sd">        :param filename: name of file to be displayed</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">PixmapFrame</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_panel_parent</span><span class="o">.</span><span class="n">add_tab</span><span class="p">(</span><span class="n">name</span> <span class="ow">or</span> <span class="s">&quot;Pixmap&quot;</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="Snuffling.web_frame"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.web_frame">[docs]</a>    <span class="k">def</span> <span class="nf">web_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a :py:class:`WebKitFrame` which can be used as a browser</span>
<span class="sd">        within snuffler.</span>

<span class="sd">        :param url: url to open</span>
<span class="sd">        :param name: labels the tab</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iplot</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Web browser %i (%s)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iplot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">WebKitFrame</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_panel_parent</span><span class="o">.</span><span class="n">add_tab</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="Snuffling.vtk_frame"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.vtk_frame">[docs]</a>    <span class="k">def</span> <span class="nf">vtk_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="k">None</span><span class="p">,</span> <span class="n">actors</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a :py:class:`pyrocko.gui_util.VTKFrame` to render interactive 3D</span>
<span class="sd">        graphics.</span>

<span class="sd">        :param actors: list of VTKActors</span>
<span class="sd">        :param name: labels the tab</span>

<span class="sd">        Initialize the interactive rendering by calling the frames&#39;</span>
<span class="sd">        :py:meth`initialize` method after having added all actors to the frames</span>
<span class="sd">        renderer.</span>

<span class="sd">        Requires installation of vtk including python wrapper.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_iplot</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;VTK %i (%s)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_iplot</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">())</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">VTKFrame</span><span class="p">(</span><span class="n">actors</span><span class="o">=</span><span class="n">actors</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_panel_parent</span><span class="o">.</span><span class="n">add_tab</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="Snuffling.tempdir"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.tempdir">[docs]</a>    <span class="k">def</span> <span class="nf">tempdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a temporary directory and return its absolute path.</span>

<span class="sd">        The directory and all its contents are removed when the Snuffling</span>
<span class="sd">        instance is deleted.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempdir</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tempdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;snuffling-tmp-&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempdir</span></div>

<div class="viewcode-block" id="Snuffling.set_live_update"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.set_live_update">[docs]</a>    <span class="k">def</span> <span class="nf">set_live_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">live_update</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Enable/disable live updating.</span>

<span class="sd">        When live updates are enabled, the :py:meth:`call` method is called</span>
<span class="sd">        whenever the user changes a parameter. If it is disabled, the user has</span>
<span class="sd">        to initiate such a call manually by triggering the snuffling&#39;s menu</span>
<span class="sd">        item or pressing the call button.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_live_update</span> <span class="o">=</span> <span class="n">live_update</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_pre_process_hook</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pre_process_hook_enabled</span> <span class="o">=</span> <span class="n">live_update</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_post_process_hook</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post_process_hook_enabled</span> <span class="o">=</span> <span class="n">live_update</span></div>

<div class="viewcode-block" id="Snuffling.add_parameter"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.add_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">add_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add an adjustable parameter to the snuffling.</span>

<span class="sd">        :param param: object of type :py:class:`Param`, :py:class:`Switch`, or</span>
<span class="sd">            :py:class:`Choice`.</span>

<span class="sd">        For each parameter added, controls are added to the snuffling&#39;s panel,</span>
<span class="sd">        so that the parameter can be adjusted from the gui.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_parameter_value</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_panel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_gui</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_gui</span><span class="p">()</span></div>

<div class="viewcode-block" id="Snuffling.add_trigger"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.add_trigger">[docs]</a>    <span class="k">def</span> <span class="nf">add_trigger</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a button to the snuffling&#39;s panel.</span>

<span class="sd">        :param name:    string that labels the button</span>
<span class="sd">        :param method:  method associated with the button</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_triggers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">method</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_panel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_gui</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_gui</span><span class="p">()</span></div>

<div class="viewcode-block" id="Snuffling.get_parameters"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_parameters">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the snuffling&#39;s adjustable parameter definitions.</span>

<span class="sd">        Returns a list of objects of type :py:class:`Param`.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span></div>

<div class="viewcode-block" id="Snuffling.get_parameter"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get one of the snuffling&#39;s adjustable parameter definitions.</span>

<span class="sd">        :param ident: identifier of the parameter</span>

<span class="sd">        Returns an object of type :py:class:`Param` or ``None``.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">ident</span> <span class="o">==</span> <span class="n">ident</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">param</span>
        <span class="k">return</span> <span class="k">None</span></div>

<div class="viewcode-block" id="Snuffling.set_parameter"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.set_parameter">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set one of the snuffling&#39;s adjustable parameters.</span>

<span class="sd">        :param ident: identifier of the parameter</span>
<span class="sd">        :param value: new value of the parameter</span>

<span class="sd">        Adjusts the control of a parameter without calling :py:meth:`call`.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_parameter_value</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_controls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control</span><span class="p">:</span>
            <span class="n">control</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.set_parameter_range"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.set_parameter_range">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Set the range of one of the snuffling&#39;s adjustable parameters.</span>

<span class="sd">        :param ident: identifier of the parameter</span>
<span class="sd">        :param vmin,vmax: new minimum and maximum value for the parameter</span>

<span class="sd">        Adjusts the control of a parameter without calling :py:meth:`call`.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_controls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control</span><span class="p">:</span>
            <span class="n">control</span><span class="o">.</span><span class="n">set_range</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.set_parameter_choices"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.set_parameter_choices">[docs]</a>    <span class="k">def</span> <span class="nf">set_parameter_choices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">choices</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Update the choices of a Choice parameter.</span>

<span class="sd">        :param ident: identifier of the parameter</span>
<span class="sd">        :param choices: list of strings</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_controls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="k">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">control</span><span class="p">:</span>
            <span class="n">selected_choice</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">set_choices</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_parameter_value</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="n">selected_choice</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_set_parameter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="Snuffling.get_parameter_value"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_parameter_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_parameter_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the current value of a parameter.</span>

<span class="sd">        :param ident: identifier of the parameter</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.get_settings"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a dictionary with identifiers of all parameters as keys and</span>
<span class="sd">        their values as the dictionaries values.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">settings</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameter_value</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">settings</span></div>

    <span class="k">def</span> <span class="nf">set_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
        <span class="n">dparams</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span> <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">settings</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dparams</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_parameter_value</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_controls</span><span class="p">:</span>
                    <span class="n">control</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_param_controls</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">control</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<div class="viewcode-block" id="Snuffling.get_viewer"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_viewer">[docs]</a>    <span class="k">def</span> <span class="nf">get_viewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the parent viewer.</span>

<span class="sd">        Returns a reference to an object of type :py:class:`PileOverview`,</span>
<span class="sd">        which is the main viewer widget.</span>

<span class="sd">        If no gui has been initialized for the snuffling, a</span>
<span class="sd">        :py:exc:`NoViewerSet` exception is raised.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoViewerSet</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span></div>

<div class="viewcode-block" id="Snuffling.get_pile"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_pile">[docs]</a>    <span class="k">def</span> <span class="nf">get_pile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the pile.</span>

<span class="sd">        If a gui has been initialized, a reference to the viewer&#39;s internal</span>
<span class="sd">        pile is returned. If not, the :py:meth:`make_pile` method (which may be</span>
<span class="sd">        overloaded in subclass) is called to create a pile. This can be</span>
<span class="sd">        utilized to make hybrid snufflings, which may work also in a standalone</span>
<span class="sd">        mode.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">get_pile</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">NoViewerSet</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_viewer_pile</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_no_viewer_pile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_pile</span><span class="p">()</span>

            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_viewer_pile</span>

        <span class="k">return</span> <span class="n">p</span></div>

<div class="viewcode-block" id="Snuffling.get_active_event_and_stations"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_active_event_and_stations">[docs]</a>    <span class="k">def</span> <span class="nf">get_active_event_and_stations</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">trange</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">3600.</span><span class="p">,</span> <span class="mf">3600.</span><span class="p">),</span> <span class="n">missing</span><span class="o">=</span><span class="s">&#39;warn&#39;</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get event and stations with available data for active event.</span>

<span class="sd">        :param trange: (begin, end), time range around event origin time to</span>
<span class="sd">            query for available data</span>
<span class="sd">        :param missing: string, what to do in case of missing station</span>
<span class="sd">            information: ``&#39;warn&#39;``, ``&#39;raise&#39;`` or ``&#39;ignore&#39;``.</span>

<span class="sd">        :returns: ``(event, stations)``</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pile</span><span class="p">()</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span>

        <span class="n">event</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get_active_event</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span>
                <span class="s">&#39;No active event set. Select an event and press &quot;e&quot; to make &#39;</span>
                <span class="s">&#39;it the &quot;active event&quot;&#39;</span><span class="p">)</span>

        <span class="n">stations</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">traces</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">chopper</span><span class="p">(</span>
                <span class="n">event</span><span class="o">.</span><span class="n">time</span><span class="o">+</span><span class="n">trange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">event</span><span class="o">.</span><span class="n">time</span><span class="o">+</span><span class="n">trange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">load_data</span><span class="o">=</span><span class="k">False</span><span class="p">,</span>
                <span class="n">degap</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>

            <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">traces</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">skey</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">station_key</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">skey</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="n">station</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">get_station</span><span class="p">(</span><span class="n">skey</span><span class="p">)</span>
                    <span class="n">stations</span><span class="p">[</span><span class="n">skey</span><span class="p">]</span> <span class="o">=</span> <span class="n">station</span>

                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;No station information for station key &quot;%s&quot;.&#39;</span> \
                        <span class="o">%</span> <span class="s">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">skey</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">missing</span> <span class="o">==</span> <span class="s">&#39;warn&#39;</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">missing</span> <span class="o">==</span> <span class="s">&#39;raise&#39;</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">MissingStationInformation</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">missing</span> <span class="o">==</span> <span class="s">&#39;ignore&#39;</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="k">False</span><span class="p">,</span> <span class="s">&#39;invalid argument to &quot;missing&quot;&#39;</span>

                    <span class="n">stations</span><span class="p">[</span><span class="n">skey</span><span class="p">]</span> <span class="o">=</span> <span class="k">None</span>

        <span class="k">return</span> <span class="n">event</span><span class="p">,</span> <span class="p">[</span><span class="n">st</span> <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="n">stations</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">st</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">]</span></div>

<div class="viewcode-block" id="Snuffling.get_stations"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_stations">[docs]</a>    <span class="k">def</span> <span class="nf">get_stations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all stations known to the viewer.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span>
        <span class="n">stations</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">stations</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">stations</span></div>

<div class="viewcode-block" id="Snuffling.get_markers"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_markers">[docs]</a>    <span class="k">def</span> <span class="nf">get_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all markers from the viewer.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">get_markers</span><span class="p">()</span></div>

<div class="viewcode-block" id="Snuffling.get_event_markers"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_event_markers">[docs]</a>    <span class="k">def</span> <span class="nf">get_event_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all event markers from the viewer.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">get_markers</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">EventMarker</span><span class="p">)]</span></div>

<div class="viewcode-block" id="Snuffling.get_selected_markers"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_selected_markers">[docs]</a>    <span class="k">def</span> <span class="nf">get_selected_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all selected markers from the viewer.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">selected_markers</span><span class="p">()</span></div>

<div class="viewcode-block" id="Snuffling.get_selected_event_markers"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_selected_event_markers">[docs]</a>    <span class="k">def</span> <span class="nf">get_selected_event_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get all selected event markers from the viewer.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">selected_markers</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">EventMarker</span><span class="p">)]</span></div>

<div class="viewcode-block" id="Snuffling.get_active_event_and_phase_markers"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_active_event_and_phase_markers">[docs]</a>    <span class="k">def</span> <span class="nf">get_active_event_and_phase_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the marker of the active event and any associated phase markers</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">get_markers</span><span class="p">()</span>
        <span class="n">event_marker</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">get_active_event_marker</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event_marker</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span>
                <span class="s">&#39;No active event set. &#39;</span>
                <span class="s">&#39;Select an event and press &quot;e&quot; to make it the &quot;active event&quot;&#39;</span><span class="p">)</span>

        <span class="n">event</span> <span class="o">=</span> <span class="n">event_marker</span><span class="o">.</span><span class="n">get_event</span><span class="p">()</span>

        <span class="n">selection</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">PhaseMarker</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">get_event</span><span class="p">()</span> <span class="ow">is</span> <span class="n">event</span><span class="p">:</span>
                    <span class="n">selection</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">event_marker</span><span class="p">,</span>
            <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">markers</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">PhaseMarker</span><span class="p">)</span> <span class="ow">and</span>
             <span class="n">m</span><span class="o">.</span><span class="n">get_event</span><span class="p">()</span> <span class="o">==</span> <span class="n">event</span><span class="p">])</span></div>

<div class="viewcode-block" id="Snuffling.get_viewer_trace_selector"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_viewer_trace_selector">[docs]</a>    <span class="k">def</span> <span class="nf">get_viewer_trace_selector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;inview&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get currently active trace selector from viewer.</span>

<span class="sd">        :param mode: set to ``&#39;inview&#39;`` (default) to only include selections</span>
<span class="sd">            currently shown in the viewer, ``&#39;visible&#39; to include all traces</span>
<span class="sd">            not currenly hidden by hide or quick-select commands, or ``&#39;all&#39;``</span>
<span class="sd">            to disable any restrictions.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">rtrue</span><span class="p">(</span><span class="n">tr</span><span class="p">):</span>
            <span class="k">return</span> <span class="k">True</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;inview&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">viewer</span><span class="o">.</span><span class="n">trace_selector</span> <span class="ow">or</span> <span class="n">rtrue</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;visible&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">viewer</span><span class="o">.</span><span class="n">trace_filter</span> <span class="ow">or</span> <span class="n">rtrue</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rtrue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;invalid mode argument&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.chopper_selected_traces"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.chopper_selected_traces">[docs]</a>    <span class="k">def</span> <span class="nf">chopper_selected_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="k">False</span><span class="p">,</span> <span class="n">marker_selector</span><span class="o">=</span><span class="k">None</span><span class="p">,</span>
                                <span class="n">mode</span><span class="o">=</span><span class="s">&#39;inview&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Iterate over selected traces.</span>

<span class="sd">        Shortcut to get all trace data contained in the selected markers in the</span>
<span class="sd">        running snuffler. For each selected marker,</span>
<span class="sd">        :py:meth:`pyrocko.pile.Pile.chopper` is called with the arguments</span>
<span class="sd">        *tmin*, *tmax*, and *trace_selector* set to values according to the</span>
<span class="sd">        marker. Additional arguments to the chopper are handed over from</span>
<span class="sd">        *\*args* and *\*\*kwargs*.</span>

<span class="sd">        :param fallback: if ``True``, if no selection has been marked, use the</span>
<span class="sd">                content currently visible in the viewer.</span>
<span class="sd">        :param marker_selector: if not ``None`` a callback to filter markers.</span>
<span class="sd">        :param mode: set to ``&#39;inview&#39;`` (default) to only include selections</span>
<span class="sd">                currently shown in the viewer (excluding traces accessible</span>
<span class="sd">                through vertical scrolling), ``&#39;visible&#39;`` to include all</span>
<span class="sd">                traces not currenly hidden by hide or quick-select commands</span>
<span class="sd">                (including traces accessible through vertical scrolling), or</span>
<span class="sd">                ``&#39;all&#39;`` to disable any restrictions.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span>
            <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">viewer</span><span class="o">.</span><span class="n">selected_markers</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">EventMarker</span><span class="p">)]</span>

            <span class="k">if</span> <span class="n">marker_selector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
                <span class="n">markers</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">marker</span> <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">markers</span> <span class="k">if</span> <span class="n">marker_selector</span><span class="p">(</span><span class="n">marker</span><span class="p">)]</span>

            <span class="n">pile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pile</span><span class="p">()</span>

            <span class="k">def</span> <span class="nf">rtrue</span><span class="p">(</span><span class="n">tr</span><span class="p">):</span>
                <span class="k">return</span> <span class="k">True</span>

            <span class="n">trace_selector_arg</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;trace_selector&#39;</span><span class="p">,</span> <span class="n">rtrue</span><span class="p">)</span>
            <span class="n">trace_selector_viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer_trace_selector</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">markers</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">marker</span><span class="o">.</span><span class="n">nslc_ids</span><span class="p">:</span>
                        <span class="n">trace_selector_marker</span> <span class="o">=</span> <span class="n">rtrue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">def</span> <span class="nf">trace_selector_marker</span><span class="p">(</span><span class="n">tr</span><span class="p">):</span>
                            <span class="k">return</span> <span class="n">marker</span><span class="o">.</span><span class="n">match_nslc</span><span class="p">(</span><span class="n">tr</span><span class="o">.</span><span class="n">nslc_id</span><span class="p">)</span>

                    <span class="k">def</span> <span class="nf">trace_selector</span><span class="p">(</span><span class="n">tr</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">trace_selector_arg</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span> \
                            <span class="ow">and</span> <span class="n">trace_selector_viewer</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span> \
                            <span class="ow">and</span> <span class="n">trace_selector_marker</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>

                    <span class="k">for</span> <span class="n">traces</span> <span class="ow">in</span> <span class="n">pile</span><span class="o">.</span><span class="n">chopper</span><span class="p">(</span>
                            <span class="n">tmin</span><span class="o">=</span><span class="n">marker</span><span class="o">.</span><span class="n">tmin</span><span class="p">,</span>
                            <span class="n">tmax</span><span class="o">=</span><span class="n">marker</span><span class="o">.</span><span class="n">tmax</span><span class="p">,</span>
                            <span class="n">trace_selector</span><span class="o">=</span><span class="n">trace_selector</span><span class="p">,</span>
                            <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

                        <span class="k">yield</span> <span class="n">traces</span>

            <span class="k">elif</span> <span class="n">fallback</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">trace_selector</span><span class="p">(</span><span class="n">tr</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">trace_selector_arg</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span> \
                        <span class="ow">and</span> <span class="n">trace_selector_viewer</span><span class="p">(</span><span class="n">tr</span><span class="p">)</span>

                <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">get_time_range</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">traces</span> <span class="ow">in</span> <span class="n">pile</span><span class="o">.</span><span class="n">chopper</span><span class="p">(</span>
                        <span class="n">tmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span>
                        <span class="n">tmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">,</span>
                        <span class="n">trace_selector</span><span class="o">=</span><span class="n">trace_selector</span><span class="p">,</span>
                        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

                    <span class="k">yield</span> <span class="n">traces</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NoTracesSelected</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">NoViewerSet</span><span class="p">:</span>
            <span class="n">pile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pile</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">traces</span> <span class="ow">in</span> <span class="n">pile</span><span class="o">.</span><span class="n">chopper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">traces</span></div>

<div class="viewcode-block" id="Snuffling.get_selected_time_range"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.get_selected_time_range">[docs]</a>    <span class="k">def</span> <span class="nf">get_selected_time_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fallback</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get the time range spanning all selected markers.</span>

<span class="sd">        :param fallback: if ``True`` and no marker is selected return begin and</span>
<span class="sd">            end of visible time range</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">selected_markers</span><span class="p">()</span>
        <span class="n">mins</span> <span class="o">=</span> <span class="p">[</span><span class="n">marker</span><span class="o">.</span><span class="n">tmin</span> <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">]</span>
        <span class="n">maxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">marker</span><span class="o">.</span><span class="n">tmax</span> <span class="k">for</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">markers</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">mins</span> <span class="ow">and</span> <span class="n">maxs</span><span class="p">:</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mins</span><span class="p">)</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxs</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">fallback</span><span class="p">:</span>
            <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span> <span class="o">=</span> <span class="n">viewer</span><span class="o">.</span><span class="n">get_time_range</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoTracesSelected</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span></div>

<div class="viewcode-block" id="Snuffling.panel_visibility_changed"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.panel_visibility_changed">[docs]</a>    <span class="k">def</span> <span class="nf">panel_visibility_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Called when the snuffling&#39;s panel becomes visible or is hidden.</span>

<span class="sd">        Can be overloaded in subclass, e.g. to perform additional setup actions</span>
<span class="sd">        when the panel is activated the first time.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">pass</span></div>

<div class="viewcode-block" id="Snuffling.make_pile"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.make_pile">[docs]</a>    <span class="k">def</span> <span class="nf">make_pile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a pile.</span>

<span class="sd">        To be overloaded in subclass. The default implementation just calls</span>
<span class="sd">        :py:func:`pyrocko.pile.make_pile` to create a pile from command line</span>
<span class="sd">        arguments.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">cachedirname</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">config</span><span class="p">()</span><span class="o">.</span><span class="n">cache_dir</span>
        <span class="n">sources</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cli_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;sources&#39;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">return</span> <span class="n">pile</span><span class="o">.</span><span class="n">make_pile</span><span class="p">(</span>
            <span class="n">sources</span><span class="p">,</span>
            <span class="n">cachedirname</span><span class="o">=</span><span class="n">cachedirname</span><span class="p">,</span>
            <span class="n">regex</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli_params</span><span class="p">[</span><span class="s">&#39;regex&#39;</span><span class="p">],</span>
            <span class="n">fileformat</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cli_params</span><span class="p">[</span><span class="s">&#39;format&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="Snuffling.make_panel"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.make_panel">[docs]</a>    <span class="k">def</span> <span class="nf">make_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a widget for the snuffling&#39;s control panel.</span>

<span class="sd">        Normally called from the :py:meth:`setup_gui` method. Returns ``None``</span>
<span class="sd">        if no panel is needed (e.g. if the snuffling has no adjustable</span>
<span class="sd">        parameters).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_param_controls</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">params</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_force_panel</span><span class="p">:</span>
            <span class="n">sarea</span> <span class="o">=</span> <span class="n">MyScrollArea</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">get_panel_parent_widget</span><span class="p">())</span>
            <span class="n">sarea</span><span class="o">.</span><span class="n">setFrameStyle</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">NoFrame</span><span class="p">)</span>
            <span class="n">sarea</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="p">(</span>
                <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">))</span>
            <span class="n">frame</span> <span class="o">=</span> <span class="n">MyFrame</span><span class="p">(</span><span class="n">sarea</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">frame</span><span class="p">,</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;widgetVisibilityChanged(bool)&#39;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">panel_visibility_changed</span><span class="p">)</span>

            <span class="n">frame</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="p">(</span>
                <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">))</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">setFrameStyle</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">NoFrame</span><span class="p">)</span>
            <span class="n">sarea</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
            <span class="n">sarea</span><span class="o">.</span><span class="n">setWidgetResizable</span><span class="p">(</span><span class="k">True</span><span class="p">)</span>
            <span class="n">layout</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>

            <span class="n">parlayout</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>

            <span class="n">irow</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ipar</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">have_switches</span> <span class="o">=</span> <span class="k">False</span>
            <span class="n">have_params</span> <span class="o">=</span> <span class="k">False</span>
            <span class="k">for</span> <span class="n">iparam</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Param</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">minimum</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">param_control</span> <span class="o">=</span> <span class="n">LinValControl</span><span class="p">(</span>
                            <span class="n">high_is_none</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">high_is_none</span><span class="p">,</span>
                            <span class="n">low_is_none</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">low_is_none</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">param_control</span> <span class="o">=</span> <span class="n">ValControl</span><span class="p">(</span>
                            <span class="n">high_is_none</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">high_is_none</span><span class="p">,</span>
                            <span class="n">low_is_none</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">low_is_none</span><span class="p">,</span>
                            <span class="n">low_is_zero</span><span class="o">=</span><span class="n">param</span><span class="o">.</span><span class="n">low_is_zero</span><span class="p">)</span>

                    <span class="n">param_control</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span>
                        <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">param</span><span class="o">.</span><span class="n">minimum</span><span class="p">,</span>
                        <span class="n">param</span><span class="o">.</span><span class="n">maximum</span><span class="p">,</span>
                        <span class="n">param</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
                        <span class="n">iparam</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                        <span class="n">param_control</span><span class="p">,</span>
                        <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;valchange(PyQt_PyObject,int)&quot;</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">modified_snuffling_panel</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_param_controls</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_control</span>
                    <span class="k">for</span> <span class="n">iw</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param_control</span><span class="o">.</span><span class="n">widgets</span><span class="p">()):</span>
                        <span class="n">parlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="n">iw</span><span class="p">)</span>

                    <span class="n">ipar</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">have_params</span> <span class="o">=</span> <span class="k">True</span>

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Choice</span><span class="p">):</span>
                    <span class="n">param_widget</span> <span class="o">=</span> <span class="n">ChoiceControl</span><span class="p">(</span>
                        <span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">choices</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                        <span class="n">param_widget</span><span class="p">,</span>
                        <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;choosen(PyQt_PyObject,PyQt_PyObject)&#39;</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">choose_on_snuffling_panel</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_param_controls</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_widget</span>
                    <span class="n">parlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">param_widget</span><span class="p">,</span> <span class="n">ipar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                    <span class="n">ipar</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">have_params</span> <span class="o">=</span> <span class="k">True</span>

                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Switch</span><span class="p">):</span>
                    <span class="n">have_switches</span> <span class="o">=</span> <span class="k">True</span>

            <span class="k">if</span> <span class="n">have_params</span><span class="p">:</span>
                <span class="n">parframe</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QFrame</span><span class="p">(</span><span class="n">sarea</span><span class="p">)</span>
                <span class="n">parframe</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="p">(</span>
                    <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">))</span>
                <span class="n">parframe</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">parlayout</span><span class="p">)</span>
                <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">parframe</span><span class="p">,</span> <span class="n">irow</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">irow</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">have_switches</span><span class="p">:</span>
                <span class="n">swlayout</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QGridLayout</span><span class="p">()</span>
                <span class="n">isw</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">iparam</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">Switch</span><span class="p">):</span>
                        <span class="n">param_widget</span> <span class="o">=</span> <span class="n">SwitchControl</span><span class="p">(</span>
                            <span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                            <span class="n">param_widget</span><span class="p">,</span>
                            <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;sw_toggled(PyQt_PyObject,bool)&#39;</span><span class="p">),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">switch_on_snuffling_panel</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_param_controls</span><span class="p">[</span><span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_widget</span>
                        <span class="n">swlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">param_widget</span><span class="p">,</span> <span class="n">isw</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="n">isw</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span>
                        <span class="n">isw</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">swframe</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QFrame</span><span class="p">(</span><span class="n">sarea</span><span class="p">)</span>
                <span class="n">swframe</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="p">(</span>
                    <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">))</span>
                <span class="n">swframe</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">swlayout</span><span class="p">)</span>
                <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">swframe</span><span class="p">,</span> <span class="n">irow</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">irow</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">butframe</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QFrame</span><span class="p">(</span><span class="n">sarea</span><span class="p">)</span>
            <span class="n">butframe</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="p">(</span>
                <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Minimum</span><span class="p">))</span>
            <span class="n">butlayout</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
            <span class="n">butframe</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">butlayout</span><span class="p">)</span>

            <span class="n">live_update_checkbox</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s">&#39;Auto-Run&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_update</span><span class="p">:</span>
                <span class="n">live_update_checkbox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>

            <span class="n">butlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">live_update_checkbox</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">live_update_checkbox</span><span class="p">,</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;toggled(bool)&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">live_update_toggled</span><span class="p">)</span>

            <span class="n">help_button</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s">&#39;Help&#39;</span><span class="p">)</span>
            <span class="n">butlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">help_button</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">help_button</span><span class="p">,</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">help_button_triggered</span><span class="p">)</span>

            <span class="n">clear_button</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s">&#39;Clear&#39;</span><span class="p">)</span>
            <span class="n">butlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">clear_button</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">clear_button</span><span class="p">,</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_button_triggered</span><span class="p">)</span>

            <span class="n">call_button</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s">&#39;Run&#39;</span><span class="p">)</span>
            <span class="n">butlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">call_button</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="n">call_button</span><span class="p">,</span>
                <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;clicked()&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">call_button_triggered</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_triggers</span><span class="p">:</span>
                <span class="n">but</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

                <span class="k">def</span> <span class="nf">call_and_update</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
                    <span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">method</span><span class="p">()</span>
                        <span class="k">except</span> <span class="n">SnufflingError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">SnufflingCallFailed</span><span class="p">):</span>
                                <span class="c"># those have logged within error()</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;%s: %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                <span class="s">&#39;%s: Snuffling action failed&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
                    <span class="k">return</span> <span class="n">f</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                    <span class="n">but</span><span class="p">,</span>
                    <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;clicked()&#39;</span><span class="p">),</span>
                    <span class="n">call_and_update</span><span class="p">(</span><span class="n">method</span><span class="p">))</span>

                <span class="n">butlayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">but</span><span class="p">)</span>

            <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">butframe</span><span class="p">,</span> <span class="n">irow</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">irow</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">spacer</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QSpacerItem</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">,</span> <span class="n">qg</span><span class="o">.</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Expanding</span><span class="p">)</span>

            <span class="n">layout</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">spacer</span><span class="p">,</span> <span class="n">irow</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">sarea</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">None</span></div>

<div class="viewcode-block" id="Snuffling.make_helpmenuitem"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.make_helpmenuitem">[docs]</a>    <span class="k">def</span> <span class="nf">make_helpmenuitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create the help menu item for the snuffling.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">item</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="k">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">item</span><span class="p">,</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered(bool)&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">help_button_triggered</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">item</span></div>

<div class="viewcode-block" id="Snuffling.make_menuitem"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.make_menuitem">[docs]</a>    <span class="k">def</span> <span class="nf">make_menuitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create the menu item for the snuffling.</span>

<span class="sd">        This method may be overloaded in subclass and return ``None``, if no</span>
<span class="sd">        menu entry is wanted.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">item</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">(),</span> <span class="k">None</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_have_pre_process_hook</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_post_process_hook</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&quot;triggered(bool)&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuitem_triggered</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">item</span></div>

<div class="viewcode-block" id="Snuffling.output_filename"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.output_filename">[docs]</a>    <span class="k">def</span> <span class="nf">output_filename</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">caption</span><span class="o">=</span><span class="s">&#39;Save File&#39;</span><span class="p">,</span>
            <span class="nb">dir</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="nb">filter</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="n">selected_filter</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Query user for an output filename.</span>

<span class="sd">        This is currently a wrapper to :py:func:`QFileDialog.getSaveFileName`.</span>
<span class="sd">        A :py:exc:`UserCancelled` exception is raised if the user cancels the</span>
<span class="sd">        dialog.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dir</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_output_filename</span><span class="p">:</span>
            <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_output_filename</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">(),</span> <span class="n">caption</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">selected_filter</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fn</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserCancelled</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_output_filename</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.input_directory"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.input_directory">[docs]</a>    <span class="k">def</span> <span class="nf">input_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="s">&#39;Open Directory&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Query user for an input directory.</span>

<span class="sd">        This is a wrapper to :py:func:`QFileDialog.getExistingDirectory`.</span>
<span class="sd">        A :py:exc:`UserCancelled` exception is raised if the user cancels the</span>
<span class="sd">        dialog.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dir</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_input_directory</span><span class="p">:</span>
            <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_input_directory</span>

        <span class="n">dirn</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span>
            <span class="k">None</span><span class="p">,</span> <span class="n">caption</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">qg</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">ShowDirsOnly</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">dirn</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserCancelled</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_input_directory</span> <span class="o">=</span> <span class="n">dirn</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">dirn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.input_filename"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.input_filename">[docs]</a>    <span class="k">def</span> <span class="nf">input_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="s">&#39;Open File&#39;</span><span class="p">,</span> <span class="nb">dir</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                       <span class="n">selected_filter</span><span class="o">=</span><span class="k">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Query user for an input filename.</span>

<span class="sd">        This is currently a wrapper to :py:func:`QFileDialog.getOpenFileName`.</span>
<span class="sd">        A :py:exc:`UserCancelled` exception is raised if the user cancels the</span>
<span class="sd">        dialog.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dir</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_input_filename</span><span class="p">:</span>
            <span class="nb">dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_input_filename</span>

        <span class="n">fn</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">(),</span>
            <span class="n">caption</span><span class="p">,</span>
            <span class="nb">dir</span><span class="p">,</span>
            <span class="nb">filter</span><span class="p">,</span>
            <span class="n">selected_filter</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fn</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserCancelled</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_input_filename</span> <span class="o">=</span> <span class="n">fn</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.input_dialog"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.input_dialog">[docs]</a>    <span class="k">def</span> <span class="nf">input_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Query user for a text input.</span>

<span class="sd">        This is currently a wrapper to :py:func:`QInputDialog.getText`.</span>
<span class="sd">        A :py:exc:`UserCancelled` exception is raised if the user cancels the</span>
<span class="sd">        dialog.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">inp</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">(),</span> <span class="s">&#39;Input&#39;</span><span class="p">,</span> <span class="n">caption</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserCancelled</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">inp</span></div>

<div class="viewcode-block" id="Snuffling.modified_snuffling_panel"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.modified_snuffling_panel">[docs]</a>    <span class="k">def</span> <span class="nf">modified_snuffling_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">iparam</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Called when the user has played with an adjustable parameter.</span>

<span class="sd">        The default implementation sets the parameter, calls the snuffling&#39;s</span>
<span class="sd">        :py:meth:`call` method and finally triggers an update on the viewer</span>
<span class="sd">        widget.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()[</span><span class="n">iparam</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_parameter_value</span><span class="p">(</span><span class="n">param</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_call</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="Snuffling.switch_on_snuffling_panel"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.switch_on_snuffling_panel">[docs]</a>    <span class="k">def</span> <span class="nf">switch_on_snuffling_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Called when the user has toggled a switchable parameter.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_parameter_value</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_call</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="Snuffling.choose_on_snuffling_panel"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.choose_on_snuffling_panel">[docs]</a>    <span class="k">def</span> <span class="nf">choose_on_snuffling_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Called when the user has made a choice about a choosable parameter.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_parameter_value</span><span class="p">(</span><span class="n">ident</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_live_update</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_call</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="Snuffling.menuitem_triggered"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.menuitem_triggered">[docs]</a>    <span class="k">def</span> <span class="nf">menuitem_triggered</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Called when the user has triggered the snuffling&#39;s menu.</span>

<span class="sd">        The default implementation calls the snuffling&#39;s :py:meth:`call` method</span>
<span class="sd">        and triggers an update on the viewer widget.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_call</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_pre_process_hook</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pre_process_hook_enabled</span> <span class="o">=</span> <span class="n">arg</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_post_process_hook</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post_process_hook_enabled</span> <span class="o">=</span> <span class="n">arg</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_pre_process_hook</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_have_post_process_hook</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">clean_update</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="Snuffling.call_button_triggered"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.call_button_triggered">[docs]</a>    <span class="k">def</span> <span class="nf">call_button_triggered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Called when the user has clicked the snuffling&#39;s call button.</span>

<span class="sd">        The default implementation calls the snuffling&#39;s :py:meth:`call` method</span>
<span class="sd">        and triggers an update on the viewer widget.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_call</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="Snuffling.clear_button_triggered"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.clear_button_triggered">[docs]</a>    <span class="k">def</span> <span class="nf">clear_button_triggered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Called when the user has clicked the snuffling&#39;s clear button.</span>

<span class="sd">        This calls the :py:meth:`cleanup` method and triggers an update on the</span>
<span class="sd">        viewer widget.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="Snuffling.help_button_triggered"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.help_button_triggered">[docs]</a>    <span class="k">def</span> <span class="nf">help_button_triggered</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a :py:class:`QLabel` which contains the documentation as</span>
<span class="sd">        given in the snufflings&#39; __doc__ string.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;&lt;html&gt;&#39;</span><span class="p">):</span>
                    <span class="n">doc</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">import</span> <span class="nn">markdown</span>
                    <span class="n">doc</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">markdown</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span><span class="p">))</span>

                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                    <span class="n">doc</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__doc__</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">doc</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s">&#39;This snuffling does not provide any online help.&#39;</span><span class="p">)</span>

        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">doc</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">cgi</span>
            <span class="kn">import</span> <span class="nn">urllib</span>
            <span class="n">code</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

            <span class="n">doc_src</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span>
                <span class="sd">&#39;&#39;&#39;&lt;html&gt;&lt;body&gt;</span>
<span class="sd">&lt;hr /&gt;</span>
<span class="sd">&lt;center&gt;&lt;em&gt;May the source be with you, young Skywalker!&lt;/em&gt;&lt;br /&gt;&lt;br /&gt;</span>
<span class="sd">&lt;a href=&quot;file://%s&quot;&gt;&lt;code&gt;%s&lt;/code&gt;&lt;/a&gt;&lt;/center&gt;</span>
<span class="sd">&lt;br /&gt;</span>
<span class="sd">&lt;p style=&quot;margin-left: 2em; margin-right: 2em; background-color:#eed;&quot;&gt;</span>
<span class="sd">&lt;pre style=&quot;white-space: pre-wrap&quot;&gt;&lt;code&gt;%s</span>
<span class="sd">&lt;/code&gt;&lt;/pre&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&#39;&#39;&#39;</span>
                <span class="o">%</span> <span class="p">(</span>
                    <span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">),</span>
                    <span class="n">cgi</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">),</span>
                    <span class="n">cgi</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">code</span><span class="p">)))</span>

            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_src</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
            <span class="n">h</span><span class="o">.</span><span class="n">setAlignment</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignTop</span> <span class="o">|</span> <span class="n">qc</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignLeft</span><span class="p">)</span>
            <span class="n">h</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="k">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_viewer</span><span class="o">.</span><span class="n">show_doc</span><span class="p">(</span><span class="s">&#39;Help: %s&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s">&#39;panel&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.live_update_toggled"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.live_update_toggled">[docs]</a>    <span class="k">def</span> <span class="nf">live_update_toggled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">on</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Called when the checkbox for live-updates has been toggled.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_live_update</span><span class="p">(</span><span class="n">on</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.add_traces"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.add_traces">[docs]</a>    <span class="k">def</span> <span class="nf">add_traces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traces</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add traces to the viewer.</span>

<span class="sd">        :param traces: list of objects of type :py:class:`pyrocko.trace.Trace`</span>

<span class="sd">        The traces are put into a :py:class:`pyrocko.pile.MemTracesFile` and</span>
<span class="sd">        added to the viewer&#39;s internal pile for display. Note, that unlike with</span>
<span class="sd">        the traces from the files given on the command line, these traces are</span>
<span class="sd">        kept in memory and so may quickly occupy a lot of ram if a lot of</span>
<span class="sd">        traces are added.</span>

<span class="sd">        This method should be preferred over modifying the viewer&#39;s internal</span>
<span class="sd">        pile directly, because this way, the snuffling has a chance to</span>
<span class="sd">        automatically remove its private traces again (see :py:meth:`cleanup`</span>
<span class="sd">        method).</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">ticket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">add_traces</span><span class="p">(</span><span class="n">traces</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tickets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ticket</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ticket</span></div>

<div class="viewcode-block" id="Snuffling.add_trace"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.add_trace">[docs]</a>    <span class="k">def</span> <span class="nf">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tr</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a trace to the viewer.</span>

<span class="sd">        See :py:meth:`add_traces`.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_traces</span><span class="p">([</span><span class="n">tr</span><span class="p">])</span></div>

<div class="viewcode-block" id="Snuffling.add_markers"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.add_markers">[docs]</a>    <span class="k">def</span> <span class="nf">add_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">markers</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add some markers to the display.</span>

<span class="sd">        Takes a list of objects of type :py:class:`pyrocko.gui_util.Marker` and</span>
<span class="sd">        adds these to the viewer.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span><span class="o">.</span><span class="n">add_markers</span><span class="p">(</span><span class="n">markers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_markers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">markers</span><span class="p">)</span></div>

<div class="viewcode-block" id="Snuffling.add_marker"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.add_marker">[docs]</a>    <span class="k">def</span> <span class="nf">add_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Add a marker to the display.</span>

<span class="sd">        See :py:meth:`add_markers`.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_markers</span><span class="p">([</span><span class="n">marker</span><span class="p">])</span></div>

<div class="viewcode-block" id="Snuffling.cleanup"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.cleanup">[docs]</a>    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Remove all traces and markers which have been added so far by the</span>
<span class="sd">        snuffling.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">viewer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_viewer</span><span class="p">()</span>
            <span class="n">viewer</span><span class="o">.</span><span class="n">release_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tickets</span><span class="p">)</span>
            <span class="n">viewer</span><span class="o">.</span><span class="n">remove_markers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_markers</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">NoViewerSet</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tickets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_markers</span> <span class="o">=</span> <span class="p">[]</span></div>

    <span class="k">def</span> <span class="nf">check_call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="n">SnufflingError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">SnufflingCallFailed</span><span class="p">):</span>
                <span class="c"># those have logged within error()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;%s: %s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;%s: Snuffling action failed&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

<div class="viewcode-block" id="Snuffling.call"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.call">[docs]</a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Main work routine of the snuffling.</span>

<span class="sd">        This method is called when the snuffling&#39;s menu item has been triggered</span>
<span class="sd">        or when the user has played with the panel controls. To be overloaded</span>
<span class="sd">        in subclass. The default implementation does nothing useful.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">pass</span></div>

    <span class="k">def</span> <span class="nf">pre_process_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traces</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">traces</span>

    <span class="k">def</span> <span class="nf">post_process_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traces</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">traces</span>

<div class="viewcode-block" id="Snuffling.pre_destroy"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.Snuffling.pre_destroy">[docs]</a>    <span class="k">def</span> <span class="nf">pre_destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Called when the snuffling instance is about to be deleted.</span>

<span class="sd">        Can be overloaded to do user-defined cleanup actions.  The</span>
<span class="sd">        default implementation calls :py:meth:`cleanup` and deletes</span>
<span class="sd">        the snuffling`s tempory directory, if needed.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tempdir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">shutil</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tempdir</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">SnufflingError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="NoViewerSet"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.NoViewerSet">[docs]</a><span class="k">class</span> <span class="nc">NoViewerSet</span><span class="p">(</span><span class="n">SnufflingError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This exception is raised, when no viewer has been set on a Snuffling.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;No GUI available. &#39;</span> \
               <span class="s">&#39;Maybe this Snuffling cannot be run in command line mode?&#39;</span></div>


<div class="viewcode-block" id="MissingStationInformation"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.MissingStationInformation">[docs]</a><span class="k">class</span> <span class="nc">MissingStationInformation</span><span class="p">(</span><span class="n">SnufflingError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Raised when station information is missing.</span>
<span class="sd">    &#39;&#39;&#39;</span></div>


<div class="viewcode-block" id="NoTracesSelected"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.NoTracesSelected">[docs]</a><span class="k">class</span> <span class="nc">NoTracesSelected</span><span class="p">(</span><span class="n">SnufflingError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This exception is raised, when no traces have been selected in the viewer</span>
<span class="sd">    and we cannot fallback to using the current view.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;No traces have been selected / are available.&#39;</span></div>


<div class="viewcode-block" id="UserCancelled"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.UserCancelled">[docs]</a><span class="k">class</span> <span class="nc">UserCancelled</span><span class="p">(</span><span class="n">SnufflingError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This exception is raised, when the user has cancelled a snuffling dialog.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;The user has cancelled a dialog.&#39;</span></div>


<div class="viewcode-block" id="SnufflingCallFailed"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.SnufflingCallFailed">[docs]</a><span class="k">class</span> <span class="nc">SnufflingCallFailed</span><span class="p">(</span><span class="n">SnufflingError</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This exception is raised, when :py:meth:`Snuffling.fail` is called from</span>
<span class="sd">    :py:meth:`Snuffling.call`.</span>
<span class="sd">    &#39;&#39;&#39;</span></div>


<span class="k">class</span> <span class="nc">InvalidSnufflingFilename</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="SnufflingModule"><a class="viewcode-back" href="../../library/reference/snuffling.html#pyrocko.snuffling.SnufflingModule">[docs]</a><span class="k">class</span> <span class="nc">SnufflingModule</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Utility class to load/reload snufflings from a file.</span>

<span class="sd">    The snufflings are created by user modules which have the special function</span>
<span class="sd">    :py:func:`__snufflings__` which return the snuffling instances to be</span>
<span class="sd">    exported. The snuffling module is attached to a handler class, which makes</span>
<span class="sd">    use of the snufflings (e.g. :py:class:`pyrocko.pile_viewer.PileOverwiew`</span>
<span class="sd">    from ``pile_viewer.py``). The handler class must implement the methods</span>
<span class="sd">    ``add_snuffling()`` and ``remove_snuffling()`` which are used as callbacks.</span>
<span class="sd">    The callbacks are utilized from the methods :py:meth:`load_if_needed` and</span>
<span class="sd">    :py:meth:`remove_snufflings` which may be called from the handler class,</span>
<span class="sd">    when needed.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">mtimes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mtime</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_module</span> <span class="o">=</span> <span class="k">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_snufflings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span> <span class="o">=</span> <span class="n">handler</span>

    <span class="k">def</span> <span class="nf">load_if_needed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="o">+</span><span class="s">&#39;.py&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">mtime</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">8</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">BrokenSnufflingModule</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_module</span> <span class="ow">is</span> <span class="k">None</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Loading snuffling module %s&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">InvalidSnufflingFilename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">snuffling</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_module</span><span class="o">.</span><span class="n">__snufflings__</span><span class="p">():</span>
                    <span class="n">snuffling</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_snuffling</span><span class="p">(</span><span class="n">snuffling</span><span class="p">)</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_str_traceback</span><span class="p">())</span>
                <span class="k">raise</span> <span class="n">BrokenSnufflingModule</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mtime</span> <span class="o">!=</span> <span class="n">mtime</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;Reloading snuffling module %s&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_snufflings</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_path</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>

                <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_module</span>

                <span class="n">reload</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_module</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">snuffling</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_module</span><span class="o">.</span><span class="n">__snufflings__</span><span class="p">():</span>
                    <span class="n">snuffling</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="n">filename</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">add_snuffling</span><span class="p">(</span><span class="n">snuffling</span><span class="p">,</span> <span class="n">reloaded</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_snufflings</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">settings</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">sett</span><span class="p">,</span> <span class="n">snuf</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">settings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_snufflings</span><span class="p">):</span>
                        <span class="n">snuf</span><span class="o">.</span><span class="n">set_settings</span><span class="p">(</span><span class="n">sett</span><span class="p">)</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_str_traceback</span><span class="p">())</span>
                <span class="k">raise</span> <span class="n">BrokenSnufflingModule</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_mtime</span> <span class="o">=</span> <span class="n">mtime</span>

    <span class="k">def</span> <span class="nf">add_snuffling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snuffling</span><span class="p">,</span> <span class="n">reloaded</span><span class="o">=</span><span class="k">False</span><span class="p">):</span>
        <span class="n">snuffling</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>
        <span class="n">snuffling</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_snufflings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snuffling</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="o">.</span><span class="n">add_snuffling</span><span class="p">(</span><span class="n">snuffling</span><span class="p">,</span> <span class="n">reloaded</span><span class="o">=</span><span class="n">reloaded</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_snufflings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">snuffling</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_snufflings</span><span class="p">:</span>
            <span class="n">settings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snuffling</span><span class="o">.</span><span class="n">get_settings</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_handler</span><span class="o">.</span><span class="n">remove_snuffling</span><span class="p">(</span><span class="n">snuffling</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_snufflings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="n">settings</span></div>


<span class="k">class</span> <span class="nc">BrokenSnufflingModule</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">MyScrollArea</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">QScrollArea</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">sizeHint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">qc</span><span class="o">.</span><span class="n">QSize</span><span class="p">()</span>
        <span class="n">s</span><span class="o">.</span><span class="n">setWidth</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">sizeHint</span><span class="p">()</span><span class="o">.</span><span class="n">width</span><span class="p">())</span>
        <span class="n">s</span><span class="o">.</span><span class="n">setHeight</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">sizeHint</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">s</span>


<span class="k">class</span> <span class="nc">SwitchControl</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">qg</span><span class="o">.</span><span class="n">QCheckBox</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ident</span> <span class="o">=</span> <span class="n">ident</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;toggled(bool)&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sw_toggled</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sw_toggled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
            <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;sw_toggled(PyQt_PyObject,bool)&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="k">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="k">False</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ChoiceControl</span><span class="p">(</span><span class="n">qg</span><span class="o">.</span><span class="n">QFrame</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ident</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">choices</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">qg</span><span class="o">.</span><span class="n">QFrame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">120</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbox</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span> <span class="o">=</span> <span class="n">qg</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">setSpacing</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ident</span> <span class="o">=</span> <span class="n">ident</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span>
        <span class="k">for</span> <span class="n">ichoice</span><span class="p">,</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">choices</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">QString</span><span class="p">(</span><span class="n">choice</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbox</span><span class="p">,</span> <span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s">&#39;activated(int)&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">choosen</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_choices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">choices</span><span class="p">):</span>
        <span class="n">icur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbox</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">icur</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">selected_choice</span> <span class="o">=</span> <span class="n">choices</span><span class="p">[</span><span class="n">icur</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selected_choice</span> <span class="o">=</span> <span class="k">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ichoice</span><span class="p">,</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">choices</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cbox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">QString</span><span class="p">(</span><span class="n">choice</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">selected_choice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="k">None</span> <span class="ow">and</span> <span class="n">selected_choice</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">selected_choice</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">selected_choice</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">choosen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">qc</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span>
            <span class="s">&#39;choosen(PyQt_PyObject,PyQt_PyObject)&#39;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ident</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbox</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="k">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">choice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">choice</span> <span class="o">==</span> <span class="n">v</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cbox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cbox</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="k">False</span><span class="p">)</span>
</pre></div>

          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
    &nbsp;
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, The Pyrocko Developers.
    </div>
  </body>
</html>